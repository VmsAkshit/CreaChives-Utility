<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Creachive - Social Hybrid</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <style>
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .story-ring { background: linear-gradient(45deg, #f09433, #e6683c, #dc2743, #cc2366, #bc1888); padding: 3px; border-radius: 50%; }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .hidden { display: none !important; }
    </style>
</head>
<body class="bg-gray-100 text-gray-900 h-screen flex flex-col overflow-hidden font-sans">

    <!-- AUTH SCREEN -->
    <div id="auth-screen" class="fixed inset-0 bg-white z-50 flex flex-col items-center justify-center p-6 hidden">
        <h1 class="text-5xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-purple-600 to-pink-600 mb-8 tracking-tighter">Creachive</h1>
        
        <div class="w-full max-w-sm space-y-4">
            <input type="email" id="auth-email" placeholder="Email" class="w-full p-3 bg-gray-50 border border-gray-300 rounded focus:outline-none focus:border-purple-500">
            <input type="password" id="auth-pass" placeholder="Password" class="w-full p-3 bg-gray-50 border border-gray-300 rounded focus:outline-none focus:border-purple-500">
            <input type="text" id="auth-username" placeholder="Username (Register only)" class="w-full p-3 bg-gray-50 border border-gray-300 rounded focus:outline-none focus:border-purple-500 hidden">
            
            <button onclick="handleLogin()" id="btn-login" class="w-full bg-blue-500 text-white font-bold py-3 rounded hover:bg-blue-600 transition">Log In</button>
            <button onclick="handleRegister()" id="btn-register" class="w-full bg-white text-blue-500 font-bold py-3 rounded border border-blue-500 hover:bg-blue-50 transition hidden">Sign Up</button>
            
            <p class="text-center text-sm text-gray-500 mt-4 cursor-pointer" onclick="toggleAuthMode()">
                <span id="auth-toggle-text">Don't have an account? <b>Sign Up</b></span>
            </p>
            <p id="auth-error" class="text-red-500 text-center text-sm mt-2"></p>
        </div>
    </div>

    <!-- APP HEADER -->
    <header class="bg-white shadow-sm px-4 py-3 flex justify-between items-center z-10 shrink-0">
        <h1 class="text-2xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-purple-600 to-pink-600 tracking-tighter">Creachive</h1>
        <div class="flex gap-4 text-xl text-gray-600 items-center">
            <i class="fas fa-plus-square text-purple-600 cursor-pointer" onclick="showCreatePost()"></i>
            <i class="fas fa-sign-out-alt cursor-pointer hover:text-red-500" onclick="handleLogout()"></i>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main id="app-content" class="flex-1 overflow-y-auto no-scrollbar relative bg-gray-50">
        <!-- Views will be injected here -->
        <div class="p-10 text-center text-gray-500">Initializing App...</div>
    </main>

    <!-- BOTTOM NAV -->
    <nav class="bg-white border-t border-gray-200 h-16 flex justify-around items-center z-20 shrink-0">
        <button onclick="renderFeed()" id="nav-home" class="nav-btn text-2xl text-purple-600"><i class="fas fa-home"></i></button>
        <button onclick="renderExplore()" id="nav-explore" class="nav-btn text-2xl text-gray-400"><i class="fas fa-search"></i></button>
        <button onclick="renderChat()" id="nav-chat" class="nav-btn text-2xl text-gray-400"><i class="fab fa-whatsapp"></i></button>
        <button onclick="renderProfile()" id="nav-profile" class="nav-btn text-2xl text-gray-400"><i class="fas fa-user-circle"></i></button>
    </nav>

    <!-- CREATE POST MODAL -->
    <div id="create-modal" class="fixed inset-0 bg-black bg-opacity-80 z-50 hidden flex flex-col justify-end">
        <div class="bg-white rounded-t-2xl p-6 fade-in h-3/4 flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <button onclick="closeCreatePost()" class="text-gray-500">Cancel</button>
                <h3 class="font-bold">New Post</h3>
                <button onclick="submitPost()" class="text-blue-500 font-bold">Share</button>
            </div>
            <textarea id="post-caption" class="w-full p-4 bg-gray-100 rounded-lg mb-4 flex-1 resize-none focus:outline-none" placeholder="Write a caption..."></textarea>
            <input id="post-image-url" type="text" class="w-full p-3 bg-gray-100 rounded-lg mb-4" placeholder="Image URL (optional)">
            <p class="text-xs text-gray-400 text-center">Supports direct image links only.</p>
        </div>
    </div>

    <!-- ======================================================= -->
    <!--          HERE IS WHERE I ADDED YOUR CONFIG              -->
    <!-- ======================================================= -->
    <script type="module">
        // 1. Importing from CDN links so it works in the browser
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-analytics.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, updateProfile } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, query, orderBy, onSnapshot, serverTimestamp, doc, setDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // 2. Your Specific Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAutcAiOWpnvgW7GQg_JffSj2GbzcHcjXI",
            authDomain: "creachives.firebaseapp.com",
            projectId: "creachives",
            storageBucket: "creachives.firebasestorage.app",
            messagingSenderId: "232994696822",
            appId: "1:232994696822:web:938da2ae01525238637957",
            measurementId: "G-0C4CZZ31XD"
        };

        // 3. Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app); // Added Analytics
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- APP LOGIC BELOW ---
        let currentUser = null;
        let isRegisterMode = false;

        // Auth Listener
        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            if (user) {
                document.getElementById('auth-screen').classList.add('hidden');
                renderFeed(); 
            } else {
                document.getElementById('auth-screen').classList.remove('hidden');
            }
        });

        window.handleLogin = async () => {
            const email = document.getElementById('auth-email').value;
            const pass = document.getElementById('auth-pass').value;
            if(!email || !pass) return showError("Please fill all fields");
            
            try {
                await signInWithEmailAndPassword(auth, email, pass);
            } catch (e) {
                showError(e.message);
            }
        };

        window.handleRegister = async () => {
            const email = document.getElementById('auth-email').value;
            const pass = document.getElementById('auth-pass').value;
            const username = document.getElementById('auth-username').value;
            if(!email || !pass || !username) return showError("Please fill all fields");

            try {
                const cred = await createUserWithEmailAndPassword(auth, email, pass);
                await updateProfile(cred.user, { displayName: username });
                
                // Save user profile to database
                await setDoc(doc(db, 'users', cred.user.uid), {
                    username: username,
                    email: email,
                    joinedAt: serverTimestamp()
                });
            } catch (e) {
                showError(e.message);
            }
        };

        window.handleLogout = () => signOut(auth);

        window.toggleAuthMode = () => {
            isRegisterMode = !isRegisterMode;
            document.getElementById('btn-login').classList.toggle('hidden');
            document.getElementById('btn-register').classList.toggle('hidden');
            document.getElementById('auth-username').classList.toggle('hidden');
            document.getElementById('auth-toggle-text').innerHTML = isRegisterMode ? 
                "Already have an account? <b>Log In</b>" : "Don't have an account? <b>Sign Up</b>";
        };

        function showError(msg) {
            document.getElementById('auth-error').innerText = msg.replace('Firebase:', '').replace('auth/', '');
        }

        // --- VIEWS ---

        window.renderFeed = () => {
            setActiveNav('nav-home');
            const container = document.getElementById('app-content');
            container.innerHTML = `<div class="p-10 text-center text-gray-500">Loading feed...</div>`;

            const q = query(collection(db, 'posts'), orderBy('createdAt', 'desc'));
            
            onSnapshot(q, (snapshot) => {
                const posts = [];
                snapshot.forEach(doc => posts.push({id: doc.id, ...doc.data()}));
                
                let html = `
                <div class="pb-20">
                    <div class="bg-white p-4 flex gap-4 overflow-x-auto no-scrollbar border-b border-gray-100 mb-2">
                         <div class="flex flex-col items-center min-w-[70px]">
                            <div class="story-ring p-[2px]">
                                <div class="bg-white rounded-full p-0.5">
                                    <div class="w-14 h-14 bg-gray-200 rounded-full flex items-center justify-center text-xl cursor-pointer" onclick="showCreatePost()">+</div>
                                </div>
                            </div>
                            <span class="text-xs mt-1">Story</span>
                        </div>
                    </div>
                    <div class="space-y-4">
                `;

                if(posts.length === 0) html += `<div class="p-8 text-center text-gray-500">No posts yet. Share something!</div>`;

                html += posts.map(p => `
                    <div class="bg-white shadow-sm pb-2">
                        <div class="flex items-center p-3">
                            <div class="w-8 h-8 rounded-full mr-3 bg-purple-100 flex items-center justify-center font-bold text-purple-600 text-xs">
                                ${p.username ? p.username[0].toUpperCase() : 'U'}
                            </div>
                            <span class="font-bold text-sm">${p.username || 'User'}</span>
                        </div>
                        ${p.image ? `<img src="${p.image}" class="w-full h-auto max-h-[500px] object-cover bg-gray-100" onerror="this.style.display='none'">` : ''}
                        <div class="px-3 py-2">
                            <div class="flex gap-4 text-2xl mb-2 text-gray-700">
                                <i class="far fa-heart hover:text-red-500 cursor-pointer"></i>
                                <i class="far fa-comment"></i>
                            </div>
                            <p class="text-sm"><span class="font-bold mr-1">${p.username || 'User'}</span>${p.caption}</p>
                        </div>
                    </div>
                `).join('');
                
                html += `</div></div>`;
                container.innerHTML = html;
            }, (error) => {
                // If index fails or perm error
                console.error(error);
                if(error.code === 'failed-precondition') {
                    container.innerHTML = `<div class="p-10 text-center text-red-500">Database Index Building... Please wait a moment.</div>`;
                }
            });
        };

        window.renderChat = () => {
            setActiveNav('nav-chat');
            const container = document.getElementById('app-content');
            container.innerHTML = `
                <div class="flex flex-col h-full bg-white">
                    <div class="p-4 border-b bg-gray-50 font-bold text-green-600">Community Chat</div>
                    <div id="chat-messages" class="flex-1 overflow-y-auto p-4 space-y-2 bg-[#e5ddd5]">Loading...</div>
                    <div class="p-2 bg-gray-100 flex gap-2">
                        <input type="text" id="chat-input" class="flex-1 p-3 rounded-full border" placeholder="Message...">
                        <button onclick="sendChat()" class="w-10 h-10 bg-green-500 text-white rounded-full flex items-center justify-center"><i class="fas fa-paper-plane"></i></button>
                    </div>
                </div>
            `;

            const q = query(collection(db, 'messages'), orderBy('createdAt', 'asc'));
            onSnapshot(q, (snapshot) => {
                const msgs = [];
                snapshot.forEach(doc => msgs.push(doc.data()));
                
                const chatBox = document.getElementById('chat-messages');
                chatBox.innerHTML = msgs.map(m => {
                    const isMe = m.uid === currentUser.uid;
                    return `
                        <div class="flex flex-col ${isMe ? 'items-end' : 'items-start'}">
                            <div class="${isMe ? 'bg-[#dcf8c6]' : 'bg-white'} p-2 rounded-lg shadow max-w-[80%] text-sm">
                                ${!isMe ? `<span class="text-xs text-orange-500 font-bold block">${m.username}</span>` : ''}
                                ${m.text}
                            </div>
                        </div>
                    `;
                }).join('');
                chatBox.scrollTop = chatBox.scrollHeight;
            });
        };

        window.sendChat = async () => {
            const input = document.getElementById('chat-input');
            if(!input.value.trim()) return;
            try {
                await addDoc(collection(db, 'messages'), {
                    text: input.value,
                    uid: currentUser.uid,
                    username: currentUser.displayName,
                    createdAt: serverTimestamp()
                });
                input.value = '';
            } catch(e) { console.error(e); }
        };

        // --- HELPERS ---
        window.showCreatePost = () => document.getElementById('create-modal').classList.remove('hidden');
        window.closeCreatePost = () => document.getElementById('create-modal').classList.add('hidden');
        
        window.submitPost = async () => {
            const caption = document.getElementById('post-caption').value;
            const imgUrl = document.getElementById('post-image-url').value;
            if(!caption && !imgUrl) return;
            
            try {
                await addDoc(collection(db, 'posts'), {
                    uid: currentUser.uid,
                    username: currentUser.displayName || 'Anonymous',
                    caption: caption,
                    image: imgUrl,
                    createdAt: serverTimestamp(),
                    likes: 0
                });
                closeCreatePost();
                document.getElementById('post-caption').value = "";
                document.getElementById('post-image-url').value = "";
            } catch(e) { console.error(e); alert("Error posting: " + e.message); }
        };

        function setActiveNav(id) {
            document.querySelectorAll('.nav-btn').forEach(b => {
                b.classList.remove('text-purple-600', 'text-green-600');
                b.classList.add('text-gray-400');
            });
            const active = document.getElementById(id);
            if(active) {
                active.classList.remove('text-gray-400');
                active.classList.add(id === 'nav-chat' ? 'text-green-600' : 'text-purple-600');
            }
        }
        
        window.renderExplore = () => { setActiveNav('nav-explore'); document.getElementById('app-content').innerHTML = '<div class="p-10 text-center">Explore Feature Coming Soon</div>'; };
        window.renderProfile = () => { setActiveNav('nav-profile'); document.getElementById('app-content').innerHTML = `<div class="p-10 text-center"><h2 class="text-xl font-bold">${currentUser.displayName}</h2><p>${currentUser.email}</p></div>`; };

    </script>
</body>
</html>
